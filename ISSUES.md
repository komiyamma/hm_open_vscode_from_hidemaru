# プロジェクトの問題点

このプロジェクトには、いくつかの改善の可能性がある潜在的な問題点が存在します。

## 1. VSCodeのパス設定

VSCodeの実行可能ファイル（`code.exe`）を見つける現在の方法は、レジストリ検索や`where`コマンドに依存しており、環境によっては失敗する可能性があります。失敗した場合、ユーザーはマクロファイル (`.mac`) を手動で編集する必要があり、これはユーザーフレンドリーではありません。

**提案:**
- 設定を外部ファイル（例: `.ini`や`.json`）に切り出す。
- より堅牢な自動検出メカニズムを実装する。

## 2. TypeScriptソースコードの欠如

`vscode_extension`ディレクトリに含まれているのはコンパイル後の`extension.js`のみで、元のTypeScriptソースコード（`.ts`ファイル）がリポジトリに含まれていません。`package.json`にはTypeScriptのビルドスクリプトが定義されているため、ソースコードが存在するはずです。

**問題点:**
- コードの監査やメンテナンスが困難。
- 機能の改善やバグ修正を行うことが難しい。

## 3. マジックナンバーの使用

`HmOpenVSCodeFromHidemaru.mac`内の`calcCenterPosition`関数で、画面外のカーソル位置を計算するためにマジックナンバー`13`が使用されています。

```javascript
// 「13」は完全にマニュアルなマジックナンバーであるが、...
linenoWCS = screenTopLineNo + 13;
```

この値は特定の環境ではうまく機能するかもしれませんが、異なる画面解像度やフォントサイズでは期待通りに動作しない可能性があり、非常に脆弱です。

## 4. SCM（ソース管理）ビューの表示方法の複雑さ

SCMビューを表示するための現在の実装は非常に複雑で、副作用に依存しています。

1. マクロが`--extensionDevelopmentPath`フラグ付きでVSCodeを起動する。
2. マクロが一時ファイル (`%TEMP%\\HmOpenVSCodeFromHidemaru.txt`) を作成する。
3. VSCode拡張機能が起動時に毎回アクティブになる。
4. 拡張機能が一時ファイルの存在を確認する。
5. ファイルが存在すれば、SCMビューを表示してファイルを削除する。

この方法は、一時ファイルという外部の状態に依存しており、信頼性が低いです。また、「scm」モードを使用するたびに、開発用の拡張機能が読み込まれるという副作用もあります。

**提案:**
- VSCodeのCLIにより直接的な方法があれば、そちらを検討する。
- よりクリーンなプロセス間通信の方法を模索する。

## 5. Gitへの暗黙的な依存

このツールは、`git`コマンドがインストールされ、システムのPATHに含まれていることをことを前提としています。これは開発者向けツールとしては妥当な前提ですが、`README.md`に必須の依存関係として明記されていません。

## 6. 基本的なエラーハンドリング

エラー処理は、`message(e)`（おそらくモーダルダイアログを表示する）によって行われています。これはユーザーの操作を妨げる可能性があり、詳細なエラー情報を提供するのには不十分です。

**提案:**
- エラー情報を秀丸のアウトプットウィンドウに出力するなど、より邪魔にならず、かつ有益な方法を検討する。
